# Debt Register Locked

Register ini menjadi sumber kebenaran tunggal untuk closure debt arsitektur. Item debt hanya boleh ditutup lewat bukti gate otomatis + proof command.

## State Machine

Transisi status yang sah:

`OPEN -> IN_PROGRESS -> READY_FOR_CLOSE -> CLOSED`

Aturan closure:

1. Status `CLOSED` hanya sah jika semua gate pada kolom `Gate Lock` PASS.
2. Status `CLOSED` wajib punya `Proof Commit`, `Proof Commands`, dan `Tanggal Tutup`.
3. Jika checker belum mengunci regresi, status maksimal `READY_FOR_CLOSE`.

## Locked Debt Items

| ID | Judul | Kategori | Severity | Owner | Scope Files | Gate Lock | Exit Criteria | Status | Proof Commit | Proof Commands | Tanggal Tutup |
| --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- |
| D01 | Budget blind spot coverage belum lengkap | Guardrail | High | Architecture | `src/lib/**/*.js`<br>`public/shared/dashboard-legacy/**/*.js`<br>`public/script.js` | `pnpm check:file-budgets`<br>`pnpm check:architecture` | Rule budget mencakup seluruh scope blind spot dan tidak ada growth di atas baseline | CLOSED | `603516979203de94f637c8bb89df053004b5c297` | `pnpm check:file-budgets` PASS<br>`pnpm check:architecture` PASS<br>`GitHub Actions #13` PASS (`check-architecture`, `smoke-e2e`, `smoke-dashboard-pdf`, `smoke-admin-ui`, `visual-regression-legacy-dashboard`) | 2026-02-19 |
| D02 | Duplikasi lifecycle form version (published/draft ensure) | Logic Duplication | High | Forms + DB Bootstrap | `src/modules/forms/repository.js`<br>`src/lib/db/bootstrap/legacy-sync.js` | `pnpm check:architecture`<br>`pnpm smoke:e2e` | Satu source-of-truth lifecycle dipakai kedua file dengan perilaku idempotent identik | CLOSED | `603516979203de94f637c8bb89df053004b5c297` | `pnpm check:architecture` PASS<br>`pnpm smoke:e2e` PASS<br>`pnpm smoke:e2e:full` PASS<br>`GitHub Actions #13` PASS (`check-architecture`, `smoke-e2e`, `smoke-dashboard-pdf`, `smoke-admin-ui`, `visual-regression-legacy-dashboard`) | 2026-02-19 |
| D03 | Duplikasi canonical util/constants | Duplication | High | Architecture + Shared Utilities | `slugify`, `escapeCsvValue`, `LEGACY_SCHOOL_SLUG`, `parseJson` declaration points | `pnpm check:duplication`<br>`pnpm check:architecture` | Deklarasi canonical sesuai policy, tidak ada deklarasi baru di luar allowlist/policy | CLOSED | `603516979203de94f637c8bb89df053004b5c297` | `pnpm check:duplication` PASS<br>`pnpm check:architecture` PASS<br>`GitHub Actions #13` PASS (`check-architecture`, `smoke-e2e`, `smoke-dashboard-pdf`, `smoke-admin-ui`, `visual-regression-legacy-dashboard`) | 2026-02-19 |
| D04 | Repetisi scope predicate pada ai-prompts repositories | Maintainability | Medium | AI Prompts | `src/modules/ai-prompts/repositories/read-repository.js`<br>`src/modules/ai-prompts/repositories/draft-repository.js`<br>`src/modules/ai-prompts/repositories/publish-repository.js` | `pnpm check:duplication`<br>`pnpm check:architecture`<br>`pnpm smoke:e2e`<br>`pnpm smoke:e2e:full` | Predicate builder tunggal dipakai semua query terkait tanpa perubahan semantics | CLOSED | `2c29e9c1e08e75031f4e6de9a5534c145fc952aa` | `pnpm check:duplication` PASS<br>`pnpm check:architecture` PASS<br>`pnpm smoke:e2e` PASS<br>`pnpm smoke:e2e:full` PASS<br>`GitHub Actions #11` PASS (`check-architecture`, `smoke-e2e`, `smoke-dashboard-pdf`, `smoke-admin-ui`, `visual-regression-legacy-dashboard`) | 2026-02-19 |
| D05 | Hotspot file backend over-budget tersisa | File Budget | Medium | Module Owners | `src/modules/questionnaires/repositories/version-repository.js`<br>`src/modules/forms/repository.js`<br>`src/modules/submissions/service.js`<br>`src/modules/auth/service.js` | `pnpm check:file-budgets`<br>`pnpm check:architecture`<br>`pnpm smoke:e2e` | Semua target D05 wajib <=220 dengan hard exact-path budget | CLOSED | `2c29e9c1e08e75031f4e6de9a5534c145fc952aa` | `pnpm check:file-budgets` PASS<br>`pnpm check:architecture` PASS<br>`pnpm smoke:e2e` PASS<br>`GitHub Actions #11` PASS (`check-architecture`, `smoke-e2e`, `smoke-dashboard-pdf`, `smoke-admin-ui`, `visual-regression-legacy-dashboard`) | 2026-02-19 |
| D06 | Checker belum mengunci dynamic import di module guardrails | Guardrail | High | Architecture Tooling | `scripts/check-modular-boundaries.js`<br>`scripts/check-module-cycles.js`<br>`scripts/report-module-deps.js` | `pnpm check:modularity`<br>`pnpm check:cycles`<br>`pnpm check:architecture` | Dynamic import literal terdeteksi checker, non-literal dynamic import di `src/modules/**` ditolak | CLOSED | `603516979203de94f637c8bb89df053004b5c297` | `pnpm check:modularity` PASS<br>`pnpm check:cycles` PASS<br>`pnpm check:architecture` PASS<br>`GitHub Actions #13` PASS (`check-architecture`, `smoke-e2e`, `smoke-dashboard-pdf`, `smoke-admin-ui`, `visual-regression-legacy-dashboard`) | 2026-02-19 |
| D07 | Grandfathered file-budget debt (6 file over-max via baseline freeze) | File Budget | High | Architecture + Module Owners | `src/lib/db/bootstrap/questionnaire-sync.js`<br>`src/lib/db/bootstrap/schema-ddl.js`<br>`public/script.js`<br>`public/shared/dashboard-legacy/pdf-renderer.js`<br>`public/shared/dashboard-legacy/charts.js`<br>`public/shared/dashboard-legacy/ai.js` | `pnpm check:file-budgets`<br>`pnpm check:architecture` | Enam file target turun <= hard max rule masing-masing; baseline exemption untuk enam path dihapus; tidak ada growth debt baru | CLOSED | `b7797ab06f6cba27454c1e4868f9cf454d0d7772` | `pnpm check:file-budgets` PASS<br>`pnpm check:architecture` PASS<br>`pnpm smoke:dashboard:pdf` PASS<br>`pnpm visual:legacy-dashboard:diff` PASS<br>`pnpm visual:questionnaire-dashboard:diff` PASS<br>`pnpm smoke:admin:ui` PASS<br>`GitHub check-runs` PASS (`check-architecture`, `smoke-e2e`, `smoke-dashboard-pdf`, `smoke-admin-ui`, `visual-regression-legacy-dashboard`) | 2026-02-19 |
| D08 | Duplikasi logic aktif: validation module identik 1:1 | Logic Duplication | Medium | Questionnaires + Submissions | `src/modules/questionnaires/validation.js`<br>`src/modules/submissions/validation.js` | `pnpm check:duplication`<br>`pnpm check:architecture`<br>`pnpm smoke:e2e` | Satu source canonical dipakai bersama; perilaku validasi identik; duplikasi file identik dihapus | CLOSED | `b7797ab06f6cba27454c1e4868f9cf454d0d7772` | `pnpm check:duplication` PASS<br>`pnpm check:architecture` PASS<br>`pnpm smoke:e2e` PASS<br>`GitHub check-runs` PASS (`check-architecture`, `smoke-e2e`, `smoke-dashboard-pdf`, `smoke-admin-ui`, `visual-regression-legacy-dashboard`) | 2026-02-19 |
| D09 | Loophole checker: `export ... from ...` belum diparse sebagai dependency | Guardrail | Medium | Architecture Tooling | `scripts/check-modular-boundaries.js`<br>`scripts/check-module-cycles.js`<br>`scripts/report-module-deps.js` | `pnpm check:modularity`<br>`pnpm check:cycles`<br>`pnpm check:architecture` | Checker dependency memproses `export ... from ...` (re-export) sehingga boundary/cycle tidak bisa dibypass | CLOSED | `b7797ab06f6cba27454c1e4868f9cf454d0d7772` | `pnpm check:modularity` PASS<br>`pnpm check:cycles` PASS<br>`pnpm check:architecture` PASS<br>`GitHub check-runs` PASS (`check-architecture`, `smoke-e2e`, `smoke-dashboard-pdf`, `smoke-admin-ui`, `visual-regression-legacy-dashboard`) | 2026-02-19 |
| D10 | Branch protection required checks belum terverifikasi objektif dari governance flow | Governance | Medium | Repo Admin + Architecture | Branch protection: `backup/wip-20260218-1746`, `main` | Manual/API verification + CI evidence<br>`pnpm check:architecture` | Required checks di GitHub branch protection terpasang sesuai policy; bukti screenshot/export/settings link atau API evidence terdokumentasi | CLOSED | `5bec9c71ff9a28a6013dbf1a87ad97236f571805` | `GET /branches/main/protection` 200<br>`GET /branches/backup/wip-20260218-1746/protection` 200<br>`required_status_checks.contexts` memuat 5 check wajib (`check-architecture`, `smoke-e2e`, `smoke-dashboard-pdf`, `smoke-admin-ui`, `visual-regression-legacy-dashboard`)<br>`pnpm check:architecture` PASS | 2026-02-19 |
| D11 | Contract lock dashboard (segment query + metadata schema optional defaults) | API Contract | High | Questionnaires + Builder | `src/modules/questionnaires/query-utils.js`<br>`src/modules/questionnaires/schema.js`<br>`public/admin/questionnaire-builder/**` | `pnpm check:architecture`<br>`pnpm smoke:e2e` | Query `segmentDimensionId/segmentBucket` tervalidasi pair-wise dan metadata segment tersimpan backward-compatible | CLOSED | `a6a9a21491ca960f93d44abe85df037e388fa584` | `pnpm check:architecture` PASS<br>`pnpm smoke:e2e` PASS<br>`GitHub check-runs` PASS (`check-architecture`, `smoke-e2e`, `smoke-dashboard-pdf`, `smoke-admin-ui`, `visual-regression-legacy-dashboard`) | 2026-02-19 |
| D12 | Backend segment features (segment-compare + dataQuality + drilldown contract) | Feature Completion | High | Questionnaires Backend | `src/http/routes/tenant-admin-api/analytics-routes.js`<br>`src/modules/questionnaires/analytics-core.js`<br>`src/modules/questionnaires/responses-service.js`<br>`src/modules/questionnaires/segment-filter.js` | `pnpm check:architecture`<br>`pnpm smoke:e2e`<br>`pnpm smoke:e2e:full` | Endpoint `segment-compare` aktif, `dataQuality` tersedia, filter segment aktif di analytics/responses/export, criteria drilldown ditolak terkontrol | CLOSED | `a6a9a21491ca960f93d44abe85df037e388fa584` | `pnpm check:architecture` PASS<br>`pnpm smoke:e2e` PASS<br>`pnpm smoke:e2e:full` PASS<br>Contract probe: invalid pair => 400, compare => 200<br>`GitHub check-runs` PASS (`check-architecture`, `smoke-e2e`, `smoke-dashboard-pdf`, `smoke-admin-ui`, `visual-regression-legacy-dashboard`) | 2026-02-19 |
| D13 | Frontend segment UX + preferences v2 migration | Frontend Completion | High | Dashboard Frontend | `public/admin/questionnaire-dashboard/**` | `pnpm check:architecture`<br>`pnpm smoke:dashboard:pdf`<br>`pnpm visual:questionnaire-dashboard:diff`<br>`pnpm smoke:admin:ui` | Drilldown bucket + compare bucket bekerja, chip filter aktif, key `dashboard_visual_prefs_v2` read/write dengan fallback key lama | CLOSED | `a6a9a21491ca960f93d44abe85df037e388fa584` | `pnpm check:architecture` PASS<br>`pnpm smoke:dashboard:pdf` PASS<br>`pnpm visual:questionnaire-dashboard:diff` PASS<br>`pnpm smoke:admin:ui` PASS<br>`GitHub check-runs` PASS (`check-architecture`, `smoke-e2e`, `smoke-dashboard-pdf`, `smoke-admin-ui`, `visual-regression-legacy-dashboard`) | 2026-02-19 |
| D14 | Hardening login throttle + AI cooldown/dedup (hybrid WAF + app fallback) | Security Hardening | High | Auth + AI + Ops Docs | `src/lib/security/login-throttle.js`<br>`src/http/routes/admin-api-routes.js`<br>`src/modules/ai/*analysis-service.js`<br>`docs/CLOUDFLARE_CUTOVER_RUNBOOK.md`<br>`docs/UAT_CHECKLIST_HARDENING.md` | `pnpm check:architecture`<br>`pnpm smoke:e2e`<br>`pnpm smoke:e2e:full` | Login gagal berulang menghasilkan `429` fallback app, analyze AI identik dalam cooldown menghasilkan `reused=true` | CLOSED | `a6a9a21491ca960f93d44abe85df037e388fa584` | `pnpm check:architecture` PASS<br>`pnpm smoke:e2e` PASS<br>`pnpm smoke:e2e:full` PASS<br>Hardening probe: login attempt #6 => 429, AI analyze => reused=true<br>`GitHub check-runs` PASS (`check-architecture`, `smoke-e2e`, `smoke-dashboard-pdf`, `smoke-admin-ui`, `visual-regression-legacy-dashboard`) | 2026-02-19 |
| D15 | Closure dashboard completion D11-D14 + governance proof | Closure Governance | Medium | Architecture + Repo Admin | `docs/DEBT_REGISTER_LOCKED.md`<br>`docs/DEBT_CLOSURE_REPORT.md` | `pnpm check:debt-register`<br>`pnpm check:architecture` | D11-D14 ditutup resmi dengan proof commit SHA di base integrasi + evidence CI | CLOSED | `6e95fbaaa25dd7b6572f9127f4e91377ebde2971` | `pnpm check:debt-register` PASS<br>`pnpm check:architecture` PASS<br>`GitHub check-runs` PASS (`check-architecture`, `smoke-e2e`, `smoke-dashboard-pdf`, `smoke-admin-ui`, `visual-regression-legacy-dashboard`) | 2026-02-19 |
| D16 | Post-dashboard hardening cycle (CSRF enforce + PBKDF2 migration + analytics scaling) | Security + Performance | High | Architecture + Auth + Questionnaires | `src/lib/http/request-guards.js`<br>`src/worker.js`<br>`src/lib/security/hash.js`<br>`src/modules/auth/**`<br>`src/modules/questionnaires/**`<br>`docs/BLUEPRINT_D16_POST_DASHBOARD_HARDENING.md` | `pnpm check:architecture`<br>`pnpm smoke:e2e`<br>`pnpm smoke:e2e:full` | Scope dashboard D11-D15 tetap freeze; hardening/security/performance dieksekusi via micro PR terpisah sesuai blueprint D16 tanpa boundary leak baru | OPEN | - | - | - |
| D17 | Live parity contract/runtime lock (segment-compare + dataQuality + invalid-pair 400) | Runtime Parity | High | Questionnaires Backend + Ops | `src/http/routes/tenant-admin-api/analytics-routes.js`<br>`src/modules/questionnaires/analytics-core.js`<br>`src/modules/questionnaires/segment-filter.js`<br>`scripts/smoke-dashboard-parity.js` | `pnpm check:architecture`<br>`pnpm smoke:e2e`<br>`pnpm smoke:dashboard:parity` | Kontrak parity lulus di local, staging, dan live (`https://aitiglobal.link`) tanpa 404/mismatch | CLOSED | `63a54a30f427009099497db4f7da083b66a63c12` | `pnpm check:architecture` PASS (local)<br>`pnpm smoke:e2e` PASS (local)<br>`pnpm smoke:dashboard:parity` PASS (local)<br>`pnpm smoke:dashboard:parity -- --base-url https://aiti-forms-multischool-staging.aiti.workers.dev` PASS<br>`pnpm smoke:dashboard:parity -- --base-url https://aitiglobal.link` PASS<br>`GitHub check-runs` PASS (`check-architecture`, `smoke-e2e`, `smoke-dashboard-pdf`, `smoke-admin-ui`, `visual-regression-legacy-dashboard`, `smoke-ux-mobile`) | 2026-02-20 |
| D18 | Mobile base UX (login/admin/nav/table overflow + tap target 44px) | UX Mobile | High | Admin Frontend | `public/admin/login.html`<br>`public/shared/top-nav.css`<br>`public/admin/admin.css`<br>`public/admin/school.html`<br>`public/admin/school/**` | `pnpm check:architecture`<br>`pnpm smoke:admin:ui`<br>`pnpm smoke:ux:mobile` | Mobile 390x844 tidak overflow di login/admin page dan interaksi utama >=44px | CLOSED | `63a54a30f427009099497db4f7da083b66a63c12` | `pnpm check:architecture` PASS (local)<br>`pnpm smoke:admin:ui` PASS (local)<br>`pnpm smoke:ux:mobile` PASS (local)<br>`pnpm smoke:ux:mobile -- --base-url https://aitiglobal.link` PASS<br>Manual browser audit 390x844: `/forms/admin/login`, `/forms/kota/admin/`, `/forms/sman6-kotakupang/admin/dashboard/`, `/forms/kota/admin/questionnaires/feedback-utama/builder/` lulus tap-target >=44 dan tanpa overflow<br>`GitHub check-runs` PASS (`check-architecture`, `smoke-admin-ui`, `smoke-ux-mobile`) | 2026-02-20 |
| D19 | Public form UX polish (single-page + sticky CTA + progress + touch targets) | UX Mobile | High | Forms Frontend | `public/forms/index.html`<br>`public/forms/styles.css`<br>`public/forms/app/index.js`<br>`public/forms/app/field-renderers.js`<br>`public/forms/app/status.js`<br>`public/forms/app/form-submit.js` | `pnpm check:architecture`<br>`pnpm smoke:e2e`<br>`pnpm smoke:ux:mobile` | Public form mobile nyaman: sticky CTA aktif, progress visible, overflow hilang, label teknis dirapikan | CLOSED | `63a54a30f427009099497db4f7da083b66a63c12` | `pnpm check:architecture` PASS (local)<br>`pnpm smoke:e2e` PASS (local)<br>`pnpm smoke:ux:mobile` PASS (local)<br>`pnpm smoke:ux:mobile -- --base-url https://aitiglobal.link` PASS<br>Manual browser audit 390x844 `/forms/kota/feedback-utama/`: `docScrollWidth == docClientWidth` dan `bodyScrollWidth == bodyClientWidth`<br>`GitHub check-runs` PASS (`check-architecture`, `smoke-e2e`, `smoke-ux-mobile`) | 2026-02-20 |
| D20 | Dashboard/admin clarity + technical-noise reduction + legacy minimal polish | UX Readability | Medium | Dashboard + Superadmin Frontend | `public/admin/questionnaire-dashboard/**`<br>`public/admin/superadmin/**`<br>`public/admin/school/**` | `pnpm check:architecture`<br>`pnpm smoke:dashboard:pdf`<br>`pnpm visual:legacy-dashboard:diff`<br>`pnpm visual:questionnaire-dashboard:diff`<br>`pnpm smoke:admin:ui`<br>`pnpm smoke:ux:mobile` | Output AI ringkas+detail expandable, error teknis disembunyikan default, dan visual gate tetap lulus | CLOSED | `63a54a30f427009099497db4f7da083b66a63c12` | `pnpm check:architecture` PASS (local)<br>`pnpm smoke:dashboard:pdf` PASS (local)<br>`pnpm visual:legacy-dashboard:diff` PASS (local)<br>`pnpm visual:questionnaire-dashboard:diff` PASS (local)<br>`pnpm smoke:admin:ui` PASS (local)<br>`pnpm smoke:ux:mobile -- --base-url https://aitiglobal.link` PASS<br>Manual browser audit: debug wrappers hidden by default di `portal`, `legacy dashboard`, dan `builder`<br>`GitHub check-runs` PASS (`check-architecture`, `smoke-dashboard-pdf`, `smoke-admin-ui`, `visual-regression-legacy-dashboard`, `smoke-ux-mobile`) | 2026-02-20 |
| D21 | Final closure D17-D20 (governance + live proof) | Closure Governance | Medium | Architecture + Repo Admin | `docs/DEBT_REGISTER_LOCKED.md`<br>`docs/DEBT_CLOSURE_REPORT.md` | `pnpm check:debt-register`<br>`pnpm check:architecture` | D17-D20 berstatus CLOSED berbasis proof commit merge + smoke live hijau | CLOSED | `63a54a30f427009099497db4f7da083b66a63c12` | `pnpm check:debt-register` PASS<br>`pnpm check:architecture` PASS<br>`GitHub check-runs` PASS (`check-architecture`, `smoke-e2e`, `smoke-dashboard-pdf`, `smoke-admin-ui`, `visual-regression-legacy-dashboard`, `smoke-ux-mobile`) | 2026-02-20 |
