import { createDashboardDataController } from './dashboard-data.js';
import { createResponsesController } from './responses-ui.js';

export function wireDashboardData({
  state,
  domRefs,
  baseApiPath,
  api,
  runWithButtonLoading,
  validateDateRange,
  buildScaleAveragesFallback,
  buildQuestionLookup,
  normalizeQuestionCode,
  normalizeQuestionCriterion,
  buildCommonQuery,
  formatNumber,
  formatDateTime,
  formatVersionShort,
  setStatus,
  setError,
  presentError,
  applyVisualCardVisibility,
  syncVisualVisibilityInputs,
  chartApi,
  aiApi,
} = {}) {
  const { loadResponses, updateCsvLink } = createResponsesController({
    state,
    responsesBodyEl: domRefs.responsesBodyEl,
    responsesPageInfoEl: domRefs.responsesPageInfoEl,
    responsesPrevBtn: domRefs.responsesPrevBtn,
    responsesNextBtn: domRefs.responsesNextBtn,
    exportCsvLink: domRefs.exportCsvLink,
    formatDateTime,
    formatNumber,
    buildCommonQuery,
    baseApiPath,
    api,
  });

  const { loadSummaryAndCharts, refreshDashboardData, applySegmentDrilldown, clearSegmentDrilldown, runSegmentCompare } =
    createDashboardDataController({
    state,
    filterVersionEl: domRefs.filterVersionEl,
    scaleQuestionHelpEl: domRefs.scaleQuestionHelpEl,
    contextVersionEl: domRefs.contextVersionEl,
    contextTotalQuestionsEl: domRefs.contextTotalQuestionsEl,
    contextQuestionTypesEl: domRefs.contextQuestionTypesEl,
    contextNoteEl: domRefs.contextNoteEl,
    kpiTotalEl: domRefs.kpiTotalEl,
    kpiTodayEl: domRefs.kpiTodayEl,
    kpiScaleEl: domRefs.kpiScaleEl,
    kpiLastEl: domRefs.kpiLastEl,
    kpiOpenedDevicesEl: domRefs.kpiOpenedDevicesEl,
    kpiSubmittedEl: domRefs.kpiSubmittedEl,
    kpiOpenGapEl: domRefs.kpiOpenGapEl,
    applyFilterBtn: domRefs.applyFilterBtn,
    formatNumber,
    formatDateTime,
    formatVersionShort,
    buildCommonQuery,
    baseApiPath,
    api,
    runWithButtonLoading,
    validateDateRange,
    buildScaleAveragesFallback,
    buildQuestionLookup,
    normalizeQuestionCode,
    normalizeQuestionCriterion,
    resolveSegmentDimensions: chartApi.resolveSegmentDimensions,
    renderSegmentDimensionOptions: chartApi.renderSegmentDimensionOptions,
    renderSegmentBucketOptions: chartApi.renderSegmentBucketOptions,
    renderSegmentFilterChip: chartApi.renderSegmentFilterChip,
    getSelectedCompareBuckets: chartApi.getSelectedCompareBuckets,
    renderScaleAverageChart: chartApi.renderScaleAverageChart,
    renderRadioQuestionOptions: chartApi.renderRadioQuestionOptions,
    renderRadioDistributionChart: chartApi.renderRadioDistributionChart,
    renderCriteriaSummary: chartApi.renderCriteriaSummary,
    renderTrendChart: chartApi.renderTrendChart,
    renderAdvancedVizChart: chartApi.renderAdvancedVizChart,
    applyAdvancedVizModeAvailability: chartApi.applyAdvancedVizModeAvailability,
    updateCsvLink,
    syncVisualVisibilityInputs,
    applyVisualCardVisibility,
    loadResponses,
    loadAiLatest: aiApi.loadAiLatest,
    setStatus,
    setError,
    presentError,
    });

  return {
    loadResponses,
    loadSummaryAndCharts,
    refreshDashboardData,
    applySegmentDrilldown,
    clearSegmentDrilldown,
    runSegmentCompare,
  };
}
