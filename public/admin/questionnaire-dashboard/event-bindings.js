import { createAiEventBinder } from './event-bindings-ai.js';
import { createResponsesEventBinder } from './event-bindings-responses.js';
import { createVisualEventBinder } from './event-bindings-visual.js';

export function createDashboardEventBinder({
  state,
  VISUAL_CARD_CONFIG,
  VISUAL_PRESET_CONFIG,
  visualOrderDragState,
  applyFilterBtn,
  retryBtnEl,
  responseSearchBtn,
  responseSearchEl,
  responsesPrevBtn,
  responsesNextBtn,
  radioQuestionSelectEl,
  segmentDimensionSelectEl,
  segmentBucketSelectEl,
  segmentCompareBucketsEl,
  segmentCompareBtn,
  segmentApplyFilterBtn,
  segmentClearFilterBtn,
  analysisViewTabsContainerEl,
  advancedVizTabsContainerEl,
  visualVisibilityInputEls,
  visualLayoutApplyBtnEl,
  visualLayoutPresetEl,
  visualOrderListEl,
  visualVisibilityResetBtnEl,
  visualVisibilitySettingsEl,
  criteriaSummaryListEl,
  questionDetailCloseBtnEl,
  aiLoadBtn,
  aiRunBtn,
  aiModeEl,
  aiPdfBtn,
  filterVersionEl,
  runWithButtonLoading,
  validateDateRange,
  refreshDashboardData,
  applySegmentDrilldown,
  clearSegmentDrilldown,
  runSegmentCompare,
  loadSchoolBenchmark,
  loadResponses,
  presentError,
  setStatus,
  setError,
  renderSegmentBucketOptions,
  renderSegmentFilterChip,
  renderRadioDistributionChart,
  renderAdvancedVizChart,
  countVisibleVisualCards,
  saveVisualCardVisibility,
  setVisualLayoutPresetSelection,
  resolveMatchingVisualPresetId,
  applyVisualCardVisibility,
  applyVisualPreset,
  moveVisualCardOrder,
  findVisualOrderRowByKey,
  resetVisualOrderDragState,
  reorderVisualCardOrder,
  createDefaultVisualCardVisibility,
  createDefaultVisualCardOrder,
  saveVisualCardOrder,
  syncVisualVisibilityInputs,
  renderVisualOrderList,
  applyVisualCardOrder,
  findQuestionByCode,
  renderQuestionDetail,
  loadAiLatest,
  runAiAnalysis,
  stopAiProgressIndicator,
  setAiOutput,
  downloadAiPdf,
} = {}) {
  const { bindResponsesEvents } = createResponsesEventBinder({
    state,
    applyFilterBtn,
    retryBtnEl,
    responseSearchBtn,
    responseSearchEl,
    responsesPrevBtn,
    responsesNextBtn,
    filterVersionEl,
    runWithButtonLoading,
    validateDateRange,
    refreshDashboardData,
    loadResponses,
    presentError,
    setStatus,
    setError,
  });

  const { bindVisualEvents } = createVisualEventBinder({
    state,
    VISUAL_CARD_CONFIG,
    VISUAL_PRESET_CONFIG,
    visualOrderDragState,
    radioQuestionSelectEl,
    segmentDimensionSelectEl,
    segmentBucketSelectEl,
    segmentCompareBucketsEl,
    segmentCompareBtn,
    segmentApplyFilterBtn,
    segmentClearFilterBtn,
    analysisViewTabsContainerEl,
    advancedVizTabsContainerEl,
    visualVisibilityInputEls,
    visualLayoutApplyBtnEl,
    visualLayoutPresetEl,
    visualOrderListEl,
    visualVisibilityResetBtnEl,
    visualVisibilitySettingsEl,
    criteriaSummaryListEl,
    questionDetailCloseBtnEl,
    refreshDashboardData,
    applySegmentDrilldown,
    clearSegmentDrilldown,
    runSegmentCompare,
    loadSchoolBenchmark,
    validateDateRange,
    renderRadioDistributionChart,
    renderAdvancedVizChart,
    renderSegmentBucketOptions,
    renderSegmentFilterChip,
    countVisibleVisualCards,
    saveVisualCardVisibility,
    setVisualLayoutPresetSelection,
    resolveMatchingVisualPresetId,
    applyVisualCardVisibility,
    applyVisualPreset,
    moveVisualCardOrder,
    findVisualOrderRowByKey,
    resetVisualOrderDragState,
    reorderVisualCardOrder,
    createDefaultVisualCardVisibility,
    createDefaultVisualCardOrder,
    saveVisualCardOrder,
    syncVisualVisibilityInputs,
    renderVisualOrderList,
    applyVisualCardOrder,
    findQuestionByCode,
    renderQuestionDetail,
    setStatus,
  });

  const { bindAiEvents } = createAiEventBinder({
    aiLoadBtn,
    aiRunBtn,
    aiModeEl,
    aiPdfBtn,
    runWithButtonLoading,
    loadAiLatest,
    runAiAnalysis,
    presentError,
    setStatus,
    setError,
    stopAiProgressIndicator,
    setAiOutput,
    downloadAiPdf,
  });

  function bindEvents() {
    bindResponsesEvents();
    bindVisualEvents();
    bindAiEvents();
  }

  return {
    bindEvents,
  };
}
